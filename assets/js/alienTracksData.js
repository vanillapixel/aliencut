const remixesData = [
	{
		id: 1,
		date: {
			month: "ottobre",
			year: 2020,
		},
		songs: [
			{
				id: "oct20-g1-s1",
				artists: ["Karretta El Gucci"],
				title: "Fake Capo",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "oct20-g1-s2",
				artists: ["Carla"],
				title: "Bim Bam Toi",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "oct20-g1-s3",
				artists: ["Madison Beer"],
				title: "Good in Goodbye",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `EHN8G9PQQRGU8`,
	},
	{
		id: 2,
		date: {
			month: "novembre",
			year: 2020,
		},
		songs: [
			{
				id: "nov20-g1-s1",
				artists: ["Purple Disco Machine", "Sophie and the Giants"],
				title: "Hypnotized",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "nov20-g1-s2",
				artists: ["Ilona"],
				title: "Un monde parfait",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "nov20-g1-s3",
				artists: ["Cascada"],
				title: "Night Nurse",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `B5WU5F38KSGMJ`,
	},
	{
		id: 3,
		date: {
			month: "dicembre",
			year: 2020,
		},
		songs: [
			{
				id: "dic20-g1-s1",
				artists: ["Mabel"],
				title: "Bum Bum",
				remixArtists: ["Alien Cut", "Vixen"],
				link: "",
			},
			{
				id: "dic20-g1-s2",
				artists: ["DJane HouseKat", "Rameez"],
				title: "Ass Up",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "dic20-g1-s3",
				artists: ["Alien Cut", "Mannaggia"],
				title: "Ci siamo rotti il cazzo",
				remixArtists: [],
				link: "",
			},
		],
		paypalCode: `4BBS27AF6RRJC`,
	},
	{
		id: 4,
		date: {
			month: "gennaio",
			year: 2021,
		},
		songs: [
			{
				id: "gen21-g1-s1",
				artists: ["Piero Pelú"],
				title: "Toro loco",
				remixArtists: ["Alien Cut", "Miky Le Cause"],
				link: "",
			},
			{
				id: "gen21-g1-s2",
				artists: ["Pleasurekraft"],
				title: "Carny",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "gen21-g1-s3",
				artists: ["Comaneci"],
				title: "Satisfied Girl",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `R4BXRNSF9L2E4`,
	},

	{
		id: 5,
		date: {
			month: "febbraio",
			year: 2021,
		},
		songs: [
			{
				id: "feb21-g1-s1",
				artists: ["Worakls"],
				title: "Porto",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "feb21-g1-s2",
				artists: ["Depeche Mode"],
				title: "Personal Jesus",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "feb21-g1-s3",
				artists: ["Dj Satomi"],
				title: "Castle in the Sky",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `7HUTEPGVACU58`,
	},
	{
		id: 6,
		date: {
			month: "marzo",
			year: 2021,
		},
		songs: [
			{
				id: "mar21-g1-s1",
				artists: ["Issam Alnajjar"],
				title: "Hadal Ahbek",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "mar21-g1-s2",
				artists: ["Alien Cut"],
				title: "Pink Panther",
				remixArtists: [],
				link: "",
			},
			{
				id: "mar21-g1-s3",
				artists: ["Gigi D'Agostino", "Vize", "Emotik"],
				title: "Never be lonely",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `ESZZVRVG69MXN`,
	},
	{
		id: 7,
		date: {
			month: "aprile",
			year: 2021,
		},
		songs: [
			{
				id: "apr21-g1-s1",
				artists: ["Mace", "Ernia", "Samurai Jay"],
				title: "Sirena",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "apr21-g1-s2",
				artists: ["Loredana Bertè"],
				title: "Figlia di...",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "apr21-g1-s3",
				artists: ["Colapesce", "Dimartino"],
				title: "Musica leggerissima",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `V4P5529NP8CMU`,
	},
	{
		id: 8,
		date: {
			month: "maggio",
			year: 2021,
		},
		songs: [
			{
				id: "may21-g1-s1",
				artists: ["Ava Max "],
				title: "My Head & My Heart",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "may21-g1-s2",
				artists: ["Alvaro Soler"],
				title: "Magia",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "may21-g1-s3",
				artists: ["Alien Cut", "Marta"],
				title: "Isacco",
				remixArtists: [],
				link: "",
			},
		],
		paypalCode: `ETVK88PP7MXE8`,
	},
	{
		id: 9,
		date: {
			month: "giugno",
			year: 2021,
		},
		songs: [
			{
				id: "june21-g1-s1",
				artists: ["Marnik"],
				title: "Up & Down",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "june21-g1-s2",
				artists: ["Little Sis Nora"],
				title: "MDMA",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "june21-g1-s3",
				artists: ["Sangiovanni"],
				title: "Malibu",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `UHE8VERWM7U7L`,
	},
	{
		id: 10,
		date: {
			month: "luglio",
			year: 2021,
		},
		songs: [
			{
				id: "july21-g1-s1",
				artists: ["Ed Sheeran"],
				title: "Bad Habits",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "july21-g1-s2",
				artists: ["G Bit"],
				title: "Tapirulan",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "july21-g1-s3",
				artists: ["Deorro"],
				title: "Andele",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `T5W2ZUY2F8HS6`,
	},
	{
		id: 11,
		date: {
			month: "agosto",
			year: 2021,
		},
		songs: [
			{
				id: "august21-g1-s1",
				artists: ["Rosa Chemical, Guè Pequeno, Ernia"],
				title: "Polka 2",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "august21-g1-s2",
				artists: ["Robert Natus, Arkus P"],
				title: "Hardcore Salsa",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "august21-g1-s3",
				artists: ["Alle Farben"],
				title: "Bad Ideas",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `WAY46C2GFGB8S`,
	},
	{
		id: 12,
		date: {
			month: "settembre",
			year: 2021,
		},
		songs: [
			{
				id: "september21-g1-s1",
				artists: ["Il Tre"],
				title: "Apollo 13",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "september21-g1-s2",
				artists: ["Parov Stelar"],
				title: "Mama Talking",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "september21-g1-s3",
				artists: ["My Sun and Stars"],
				title: "Change The World",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `M4CMQRPL775ZE`,
	},
	{
		id: 13,
		date: {
			month: "ottobre",
			year: 2021,
		},
		songs: [
			{
				id: "october21-g1-s1",
				artists: ["Club House"],
				title: "Speed Of Sound",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "october21-g1-s2",
				artists: ["Jason Derulo"],
				title: "Take Me Dancing",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "october21-g1-s3",
				artists: ["Gigi D'Agostino"],
				title: "Amorelettronico",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `ZNM8US98U5H2C`,
	},
	{
		id: 14,
		date: {
			month: "novembre",
			year: 2021,
		},
		songs: [
			{
				id: "november21-g1-s1",
				artists: ["Jason Derulo"],
				title: "Acapulco",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "november21-g1-s2",
				artists: ["Italobrothers"],
				title: "Daydream",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "november21-g1-s3",
				artists: ["Freddy Mercury"],
				title: "Living on my own",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `WNGGGV94AU3QW`,
	},
	{
		id: 15,
		date: {
			month: "dicembre",
			year: 2021,
		},
		songs: [
			{
				id: "december21-g1-s1",
				artists: ["Rauw Alejandro"],
				title: "Todo de ti",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "december21-g1-s2",
				artists: ["Chiello, Shalbo"],
				title: "Quanto ti vorrei",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "december21-g1-s3",
				artists: ["Floorfilla"],
				title: "Anthem #2",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `BG2PGS3JXXDB4`,
	},
	{
		id: 16,
		date: {
			month: "gennaio",
			year: 2022,
		},
		songs: [
			{
				id: "january22-g1-s1",
				artists: ["Albe"],
				title: "Millevoci",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "january22-g1-s2",
				artists: ["Rkomi, Elodie"],
				title: "La coda del diavolo",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "january22-g1-s3",
				artists: ["Alien Cut"],
				title: "The mountain king",
				remixArtists: [],
				link: "",
			},
		],
		paypalCode: `4Q5QBGH4RNVQL`,
	},
	{
		id: 17,
		date: {
			month: "febbraio",
			year: 2022,
		},
		songs: [
			{
				id: "february22-g1-s1",
				artists: ["Gayle"],
				title: "Abdefu",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "february22-g1-s2",
				artists: ["Tananai"],
				title: "Baby Goddamn",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "february22-g1-s3",
				artists: ["Japan Girl"],
				title: "Disco Japan",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `RL2MT4PJNUAGJ`,
	},
	{
		id: 18,
		date: {
			month: "marzo",
			year: 2022,
		},
		songs: [
			{
				id: "march22-g1-s1",
				artists: ["Dargen D'amico"],
				title: "Dove Si Balla",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "march22-g1-s2",
				artists: ["Purple Disco Machine, Eyelar"],
				title: "Dopamine",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "march22-g1-s3",
				artists: ["Kanie West"],
				title: "Mercy",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `GP7NX9865QERC`,
	},
	{
		id: 19,
		date: {
			month: "aprile",
			year: 2022,
		},
		songs: [
			{
				id: "april22-g1-s1",
				artists: ["Fabri Fibra, Colapesce, Dimartino"],
				title: "Propaganda",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "april22-g1-s2",
				artists: ["Niko Pandetta"],
				title: "Pistole nella fendi",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "april22-g1-s3",
				artists: ["20 Fingers "],
				title: "Lick It",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `W6GMLX55GTRAA`,
	},
	{
		id: 20,
		date: {
			month: "maggio",
			year: 2022,
		},
		songs: [
			{
				id: "may22-g1-s1",
				artists: ["Irama feat. Willy William"],
				title: "Como Te Llamas",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "may22-g1-s2",
				artists: ["Sage The Gemini feat. Bygtwo3"],
				title: "Tick Tick Boom",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "may22-g1-s3",
				artists: ["Mahmood & Blanco"],
				title: "Brividi",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `7D7YBQMZGEYQW`,
	},
	{
		id: 21,
		date: {
			month: "giugno",
			year: 2022,
		},
		songs: [
			{
				id: "jun22-g1-s1",
				artists: ["James Hype", "Miggy Della Rosa"],
				title: "Ferrari",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "jun22-g1-s2",
				artists: ["Alvaro Soler", "Topic"],
				title: "Solo Para Ti",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "jun22-g1-s3",
				artists: ["AronChupa, Flamingoz"],
				title: "Coco Song",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `K7NWG6WNGCFF6`,
	},
	{
		id: 22,
		date: {
			month: "luglio",
			year: 2022,
		},
		songs: [
			{
				id: "jul22-g1-s1",
				artists: ["Elodie"],
				title: "Bagno a Mezzanotte",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "jul22-g1-s2",
				artists: ["Boss", "Phil The Beat"],
				title: "Closer",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "jul22-g1-s3",
				artists: ["G Bit"],
				title: "Gianmarco",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `SKQ9NS6TVVP3J`,
	},
	{
		id: 23,
		date: {
			month: "agosto",
			year: 2022,
		},
		songs: [
			{
				id: "aug22-g1-s1",
				artists: ["Fred De Palma"],
				title: "Extasy",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "aug22-g1-s2",
				artists: ["Alvaro Soler"],
				title: "My heart goes boom",
				remixArtists: ["Alien Cut"],
				link: "",
			},
			{
				id: "aug22-g1-s3",
				artists: ["Soolking"],
				title: "Suavemente",
				remixArtists: ["Alien Cut"],
				link: "",
			},
		],
		paypalCode: `7XEZ5283PVL9N`,
	},
];

const TRACKS_DATA_LIMIT = remixesData.length;

const getAlienPacksParent = (year) => {
	if (
		!document.querySelector(
			`#alien-trax-packs .alien-trax-packs-container[data-year='${year}']`
		)
	) {
		const alienTraxPackContainer = document.createElement("div");
		alienTraxPackContainer.classList.add("alien-trax-packs-container");
		alienTraxPackContainer.dataset.year = year;
		const alienTraxPacks = document.querySelector("#alien-trax-packs");
		alienTraxPacks.appendChild(alienTraxPackContainer);
	}
	return document.querySelector(
		`#alien-trax-packs .alien-trax-packs-container[data-year='${year}']`
	);
};

function trackCheckout(trackInfo) {
	const {
		paypalCode,
		songs,
		date: { month, year },
	} = trackInfo;
	let tracks = "";
	songs.forEach((song) => {
		const { title, artists, remixArtists } = song;
		tracks += `<div class="track-container">
			<span class="small-text track">${artists.join(", ")} - ${title} ${
			remixArtists.length ? `(${remixArtists.join(", ")} Rmx)` : ""
		}</span>
			</div>`;
	});
	const checkoutConfirmMessage = `
		<div class="card-column">
			<div class="conditions">
				<p class="medium-text accent-text">
					Pacchetto tracce
				</p>
				<span style="text-transform: capitalize" class="big-text">
					${month} 
					<span class="big-text secondary-text-color">${year}</span>
				</span>
				<p class="big-text">
					€30
				</p>
			</div>
		</div>
		<div class="card-column">
			<p class="xs-text secondary-text-color">
				Contiene:
			</p>
			${tracks}
		</div>
		<form action="https://www.paypal.com/cgi-bin/webscr" method="post" rel="noreferrer" target="_blank">
			<input type="hidden" name="cmd" value="_s-xclick">
			<input type="hidden" id="keyholder" name="hosted_button_id" value=${paypalCode}>
			<div style="margin: 2rem auto; max-width: clamp(230px, 60%, 550px); align-items: center" class="cta-button pulse">
			<span style="width: 20%; max-width: 50px">
				<img src="./assets/img/icons/paypal.png" alt="Paypal icon" />
			</span>
			<span class="medium-text">
				Paga con PayPal
			</span>
				<button style="width: 100%; height: 100%; opacity:0; top: 0; left: 0; right: 0; position: absolute;z-index: 999; cursor:pointer; margin: 0" type="submit" name="submit">
				</button>
			</div>
			<div class="conditions xs-text"> Condizioni:
				<div class="condition">
					<input type="checkbox" required id="conditions-ticket-reception">  
					<label class=" xs-text secondary-text-color" for="conditions-ticket-reception"> Riceverai le tracce del pacchetto selezionato sull'email del tuo account Paypal <span class="xs-text accent-text">entro DUE giorni</span> dal completamento del pagamento.</label>
				</div>
		</form>
`;

	openModal(checkoutConfirmMessage);
}

function createTracksPackageCard(trackInfo, newTracksPack = false) {
	const month = trackInfo.date.month;
	const year = trackInfo.date.year;
	const songs = trackInfo.songs;
	let tracksListHtml = "";
	const tracksPackPurchaseButton = document.createElement("button");
	tracksPackPurchaseButton.classList.add("cta-button", "pulse");
	tracksPackPurchaseButton.textContent = "Acquista pacchetto - 30€";
	tracksPackPurchaseButton.onclick = () => trackCheckout(trackInfo);
	songs.forEach((song) => {
		const { title, artists, remixArtists } = song;
		tracksListHtml += `<div class="track-container">
      <span class="small-text track">${artists.join(", ")} - ${title} ${
			remixArtists.length ? `(${remixArtists.join(", ")} Rmx)` : ""
		}</span>
      </div>`;
	});

	const tracksPackCard = document.createElement("div");
	tracksPackCard.dataset.month = month;
	tracksPackCard.classList.add("vertical-card");
	if (newTracksPack) tracksPackCard.classList.add("new-badge");

	tracksPackCard.innerHTML = `
    	<div class="card-column main-detail">
    	<p class="big-text text-underline">${month}</p>
    	<p class="medium-text secondary-text-color">${year}</p>
			</div>
			<div class="card-column card-tracks-list">
			${tracksListHtml}
			</div>
			<div class="card-column">
			<div class="trackspack-purchase-btn-container"></div>
			</div>
    `;
	const trackspackButtonContainer = tracksPackCard.querySelector(
		".trackspack-purchase-btn-container"
	);
	trackspackButtonContainer.appendChild(tracksPackPurchaseButton);

	const observer = new IntersectionObserver(
		(entries) => {
			entries.forEach((entry) => {
				entry.target.style.opacity = entry.isIntersecting ? 1 : 0;
				entry.target.style.top = entry.isIntersecting ? "15px" : 0;
				if (entry.isIntersecting) observer.unobserve(entry.target);
			});
		},
		{ threshold: 0.3 }
	);

	observer.observe(tracksPackCard);

	return tracksPackCard;
}

function createAlienTraxSection() {
	remixesData
		.sort((a, b) => (a.id < b.id ? 1 : b.id < a.id ? -1 : 0))
		.forEach((remix, id) => {
			id === 0
				? getAlienPacksParent(remix.date.year).appendChild(
						createTracksPackageCard(remix, true)
				  )
				: getAlienPacksParent(remix.date.year).appendChild(
						createTracksPackageCard(remix)
				  );
		});
}

function filterAlienTrax({ year, searchTerm }) {
	const alienTraxPackContainers = document.querySelectorAll(
		".alien-trax-packs-container"
	);
	alienTraxPackContainers.forEach((container) => {
		container.classList.add("section-container-row");
		console.log(container);
		const trackPacks = container.querySelectorAll(".vertical-card");
		trackPacks.forEach((tracksPack) => {
			const cardSongs = tracksPack.querySelector(".card-tracks-list");
			if (searchTerm.length >= 3) {
				container.style.display =
					container.getAttribute("data-year") == year &&
					cardSongs.textContent.toLowerCase().includes(searchTerm)
						? "flex"
						: "none";
				return;
			}
		});
		if (year === "all") {
			container.style.display = "flex";
			return;
		}
		container.style.display =
			container.getAttribute("data-year") == year ? "flex" : "none";
	});
}

const DEFAULT_FILTERS = { year: new Date().getFullYear(), searchTerm: "" };

let filters = DEFAULT_FILTERS;

createAlienTraxSection();
filterAlienTrax(filters);

const dateFilter = document.querySelector("#date-filter");
const years = [...new Set(remixesData.map((x) => x.date.year))];

dateFilter.setAttribute("onfocus", `this.size=${years.length + 1}`);

years.forEach((year, id) => {
	const option = document.createElement("option");
	option.value = year;
	option.textContent = year;
	year === new Date().getFullYear()
		? option.setAttribute("selected", true)
		: null;
	dateFilter.appendChild(option);
});

dateFilter.addEventListener("change", (e) => {
	filters = { ...filters, year: e.target.value };
	filterAlienTrax(filters);
});

const songFilter = document.querySelector("#song-filter");

songFilter.addEventListener("input", (e) => {
	filters = { ...filters, searchTerm: e.target.value.toLowerCase() };
	if (e.target.value.length >= 3) {
		filterAlienTrax(filters);
		return;
	}
	filters = { ...filters, searchTerm: "" };
	filterAlienTrax(filters);
});
